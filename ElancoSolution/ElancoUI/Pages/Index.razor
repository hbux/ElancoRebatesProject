@page "/"

@using ElancoLibrary.Models.Rebates

@inject FormRecogniserService recogniserService
@inject RebateOfferService rebateOfferService

<section class="rebate-ai-section">
    <div class="rebate-ai-container">
        <div class="rebate-help">
            <a>How does our rebate process work?</a>
        </div>
        <div class="rebate-ai-cards">
            <div class="rebate-upload-and-thumbnail">
                <div class="rebate-container">
                    <div class="rebate-invoice-upload">
                        <label class="rebate-invoice-upload-link" @onclick="FetchRebates">
                            <input type="file" style="display: none !important;" />
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cloud-arrow-up" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"/>
                                <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/>
                            </svg>
                            <h2>Click to upload your invoice</h2>
                            <p>Accepted file types:- .PNG and .JPEG</p>
                        </label>
                    </div>
                </div>
                <div class="rebate-container">
                    <h2>Your invoice</h2>
                    <div class="rebate-invoice-img">
                        <img src="https://b7012116pspdata.blob.core.windows.net/elanco-invoices/ElancoInvoice1.jpg?sp=r&st=2022-02-24T06:31:12Z&se=2022-02-24T14:31:12Z&spr=https&sv=2020-08-04&sr=b&sig=Z3wijZDzisw5UMwOKNFG%2FcFkXiE6e5H%2BXyFX%2FShGB%2BQ%3D" width="100px" height="120px" />
                    </div>
                </div>
            </div>
            <div class="rebate-container" id="rebate-found-products">
                <div class="rebate-header">
                    <h2>We found this matching rebate</h2>
                    <a href="#">Can't find your rebate?</a>
                </div>
                <div class="rebate-products-container">
                    <div class="rebate-product-container">
                        <div class="rebate-product-header">
                            <img src="images/InterceptorPlus.png" width="120px" height="40px" />
                            <h3>Interceptor Plus</h3>
                        </div>
                        <div class="rebate-product-details">
                            <h4>Offer Details</h4>
                            <h4>Rebate Value</h4>
                            <p>6 doses</p>
                            <p>$6</p>
                            <p>12 doses</p>
                            <p>$15</p>
                        </div>
                        <a href="#">Terms &amp; Conditions</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="rebate-form-section">
    <form>
        <div class="rebate-form-container">
            <div class="rebate-form-personal-and-pet">
                <div class="form-details">
                    <h3>Your Information</h3>
                    <div class="form-field">
                        <label for="first-name">First Name <span>*</span></label>
                        <input class="invalid-input" id="first-name" type="text" value="g"/>
                        <p class="invalid-message">Must be between 1 and 50 characters!</p>
                    </div>
                    <div class="form-field">
                        <label for="last-name">Last Name <span>*</span></label>
                        <input id="last-name" type="text" />
                    </div>
                    <div class="form-field">
                        <label for="address">Address <span>*</span></label>
                        <input id="address" type="text" />
                    </div>
                    <div class="form-field">
                        <label for="city">City <span>*</span></label>
                        <input id="city" type="text" />
                    </div>
                    <div class="form-field">
                        <label for="state">State <span>*</span></label>
                        <input id="state" type="text" />
                    </div>
                    <div class="form-field">
                        <label for="zip-code">Zip Code <span>*</span></label>
                        <input id="zip-code" type="text" />
                    </div>
                    <div class="form-field">
                        <label for="phone">Phone</label>
                        <input id="phone" type="text" />
                        <p>By providing my phone number, I consent to my phone number being used to contact me regarding my rebate submission</p>
                    </div>
                    <div class="form-field">
                        <label for="email">Email <span>*</span></label>
                        <input id="email" type="text" />
                    </div>
                    <div class="form-field">
                        <label for="confirm-email">Confirm Email <span>*</span></label>
                        <input id="confirm-email" type="text" />
                    </div>
                </div>
                <div class="form-details">
                    <h3>Pet Information</h3>
                    <p>Add your pet's name below. If you have multiple pets, please just put one of your pet's name.</p>
                    <div class="form-field">
                        <label for="pet-name">Pet Name <span>*</span></label>
                        <input class="success-input" id="pet-name" type="text" value="Bella" />
                    </div>
                </div>
            </div>
            <div class="rebate-form-purchase-and-donation">
                <div class="form-details">
                    <h3>Purchase Details</h3>
                    <p>Complete the information about your veterinarian clinic and medication(s).</p>
                    <div class="form-field">
                        <label for="clinic-name">Clinic Name <span>*</span></label>
                        <input class="low-confidence-input" id="clinic-name" type="text" value="310 BroadWalk Road 592039" />
                        <p class="low-confidence-message">Is this the correct clinic name on your invoice?</p>
                    </div>
                    <div class="form-field">
                        <label for="clinic-address">Clinic Address <span>*</span></label>
                        <input id="clinic-address" type="text" />
                    </div>
                    <div class="form-field">
                        <label for="clinic-city">Clinic City <span>*</span></label>
                        <input id="clinic-city" type="text" />
                    </div>
                    <div class="form-field">
                        <label for="clinic-state">Clinic State <span>*</span></label>
                        <input id="clinic-state" type="text" />
                    </div>
                    <div class="form-field">
                        <label for="clinic-zip-code">Clinic Zip Code <span>*</span></label>
                        <input id="clinic-zip-code" type="text" />
                    </div>
                    <div class="form-field">
                        <label for="amount-purchased">Amount Purchased <span>*</span></label>
                        <input id="amount-purchased" type="text" />
                    </div>
                </div>
                <div class="form-submit-cta">
                    <button type="submit">Submit</button> 
                </div>
            </div>
        </div>
    </form>
</section>

@code {
    private List<IRebateOfferModel> rebateOffers;

    private async Task FetchRebates() 
    {
        string invoiceUrl = "https://b7012116pspdata.blob.core.windows.net/elanco-invoices/ElancoInvoice1.jpg?sp=r&st=2022-02-24T05:57:28Z&se=2022-02-24T13:57:28Z&spr=https&sv=2020-08-04&sr=b&sig=OcUB%2F%2FR1jwsTG3vXiQ%2BcEasznUAYG31cvr85G4DxlB0%3D";

        RecognizedFormCollection invoices = await recogniserService.AnalyseInvoice(invoiceUrl);
        rebateOfferService.FindRebateOffers(recogniserService.MapInvoiceDetails(invoices.Single()));

        rebateOffers = rebateOfferService.GetRebateOffers();
    }
}